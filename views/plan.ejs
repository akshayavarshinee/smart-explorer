<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Ubuntu:ital,wght@0,300;0,400;0,500;0,700;1,300;1,400;1,500;1,700&display=swap" rel="stylesheet">

<link rel="stylesheet" href="/plan-style.css">
<link rel="stylesheet" href="/header-footer.css">
<title>Plan Your Vacation</title>
</head>
<body>

	<%- include("partials/header.ejs") %>

	<main>
		<form action="/generate-plan" method = "POST">
			<!-- Where will you be staying -->
			<h1>Plan Your Vacation</h1>
			<section class="card">
				<h2>Where will you be staying?</h2>
				<label for="hotel">Hotel or Address</label>
				<input type="text" id="hotel" placeholder="Enter hotel name or address" name = "place" required>
				<p class="hint">We'll find amazing places near your accommodation</p>
			</section>

			<!-- Trip Dates -->
			<section class="card">
				<h2>Budget</h2>
				<div class="date-container">
					<div>
						<label for="min_price">Minimum price: </label>
						<input type="text" id="min_price" name = "min_price" required placeholder="Choose a value between 1 to 4">
					</div>
					<div>
						<label for="max_price">Maximum price: </label>
						<input type="text" id="max_price" name = "max_price" required placeholder="Choose a value between 1 to 4">
					</div>
				</div>
			</section>

			<!-- Search Radius -->
			<section class="card">
				<h2>Search Radius</h2>
				<input type="range" min="1" max="50" value="5" class="slider" name = "radius" required>
				<div class="range-labels">
					<span>1 km</span>
					<span>5 km</span>
					<span>50 km</span>
				</div>
				<p class="hint">How far are you willing to travel from your accommodation?</p>
			</section>

			<!-- Interests -->
			<section class="card">
				<h2>What interests you?</h2>
				<p class="hint">Select your preferences to get personalized recommendations</p>
				
				<div class="choose tags">
					<select name="custom-interest" class="interests custom-interest">
						<option value="">-- Select a Custom Interest --</option>
						<% Object.keys(map).forEach(function(category) { %>
							<option value="<%= category %>"><%= category %></option>
						<% }); %>
					</select>
					<br/>
					<!-- Hidden input to hold selected popular interests -->
					<input type="hidden" name="selected-interests" id="selected-interests">

					<!-- Popular Interests Buttons -->
					<% 
					const popular = [
						"Arts and Entertainment",
						"Museum",
						"Park",
						"Night Club",
						"Beach",
						"Historic Site",
						"Theater",
						"Zoo",
						"Shopping",
						"Music & Entertainment"
					]; 
					%>
					<% popular.forEach(function(category) { %>
						<% if (map[category]) { %>
							<input type="button" value="<%= category %>">
						<% } %>
					<% }); %>
				</div>

				<h5 id="selected-display" style="visibility: hidden;">You have selected</h5>
				<div class="selected tags"></div>
			</section>

			<!-- Buttons -->
			<div class="buttons">
				<a href="/home"><button class="cancel">Cancel</button></a>
				<button type="submit" class="generate">Generate Plan</button></a>
			</div>
		</form>
	</main>

	<script>
		const chooseButtons = document.querySelectorAll(".choose input[type='button']");
		const selectedContainer = document.querySelector(".selected");
		const selectedDisplay = document.querySelector("#selected-display");
		const hiddenInput = document.getElementById("selected-interests");

		chooseButtons.forEach(btn => {
			btn.addEventListener("click", () => {
			selectedDisplay.style.visibility = "visible";

			// Prevent duplicates
			const exists = Array.from(selectedContainer.children)
								.some(c => c.textContent === btn.value);
			if (exists) return;

			const added = document.createElement("button");
			added.type = "button"; // so it won't submit
			added.textContent = btn.value;
			added.classList.add("tags");

			// Remove on click
			added.addEventListener("click", () => {
				selectedContainer.removeChild(added);

				// Hide title if empty
				if (selectedContainer.children.length === 0) {
				selectedDisplay.style.visibility = "hidden";
				}

				updateHiddenInput();
			});

			selectedContainer.appendChild(added);

			updateHiddenInput();
			});
		});

		function updateHiddenInput() {
			const values = Array.from(selectedContainer.children).map(c => c.textContent);
			hiddenInput.value = JSON.stringify(values);
		}
	</script>


	<%- include("partials/footer.ejs") %>
</body>
</html>